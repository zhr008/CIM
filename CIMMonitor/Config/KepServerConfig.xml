<?xml version="1.0" encoding="UTF-8"?>
<Project 
    xmlns="http://www.kepware.com/schemas/kepserverexproject"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.kepware.com/schemas/kepserverexproject Project.xsd"
    Version="6.14.0.0"
    ProjectID="{A1B2C3D4-E5F6-7890-ABCD-EF1234567890}">
    
    <!-- 项目元数据 -->
    <Properties>
        <Property Name="ProjectName" Value="SmartFactory_EventDriven_Full"/>
        <Property Name="Description" Value="事件驱动架构-完整工业配置"/>
        <Property Name="Creator" Value="IndustrialIT_Admin"/>
        <Property Name="CreateTime" Value="2024-01-22T08:00:00Z"/>
    </Properties>

    <!-- ==================== 通道1：西门子 S7-1500 主生产线 ==================== -->
    <Channels>
        <Channel Name="Siemens_Production" Driver="Siemens TCP/IP Ethernet">
            <Properties>
                <Property Name="NetworkAdapter" Value="192.168.10.100"/>
                <Property Name="Protocol" Value="ISO-on-TCP"/>
                <Property Name="ScanRate" Value="100"/>
                <Property Name="EnableDiagnostics" Value="True"/>
            </Properties>
            
            <Devices>
                <Device Name="Assembly_Line_Main" DeviceID="1">
                    <Properties>
                        <Property Name="IPAddress" Value="192.168.10.10"/>
                        <Property Name="PLCModel" Value="S7-1500"/>
                        <Property Name="Rack" Value="0"/>
                        <Property Name="Slot" Value="1"/>
                        <Property Name="EnableAutoDemotion" Value="True"/>
                    </Properties>
                    
                    <!-- ==================== Bit组：主动订阅（高频轮询） ==================== -->
                    <TagGroups>
                        <TagGroup Name="Bit">
                            <Properties>
                                <Property Name="DefaultUpdateRate" Value="100"/>
                                <Property Name="Description" Value="主动订阅-事件触发源"/>
                            </Properties>
                            
                            <Tags>
                                <!-- 系统级触发 -->
                                <Tag Name="System_Run" Address="DB100.DBX0.0" DataType="BOOLEAN" AccessRights="ReadWrite">
                                    <Properties>
                                        <Property Name="Description" Value="系统运行总开关"/>
                                        <Property Name="ScanRate" Value="100"/>
                                        <!-- 触发：不关联Word（纯控制信号） -->
                                    </Properties>
                                </Tag>
                                
                                <Tag Name="Emergency_Stop" Address="DB100.DBX0.1" DataType="BOOLEAN" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value="急停按钮触发"/>
                                        <Property Name="ScanRate" Value="50"/>
                                        <!-- 触发：读取所有报警相关Word -->
                                        <Property Name="TriggeredTags" Value="Alarm_Status"/>
                                    </Properties>
                                </Tag>
                                
                                <!-- 电机控制触发 -->
                                <Tag Name="Motor_Start_CMD" Address="DB100.DBX2.0" DataType="BOOLEAN" AccessRights="ReadWrite">
                                    <Properties>
                                        <Property Name="Description" Value="电机启动命令（触发读取电机参数）"/>
                                        <Property Name="ScanRate" Value="100"/>
                                        <!-- 触发多个电机相关Word标签 -->
                                        <Property Name="TriggeredTags" Value="Motor_Current,Motor_Frequency"/>
                                    </Properties>
                                </Tag>
                                
                                <Tag Name="Motor_Run_Status" Address="DB100.DBX2.1" DataType="BOOLEAN" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value="电机运行状态（触发记录运行数据）"/>
                                        <Property Name="ScanRate" Value="100"/>
                                        <!-- 触发运行数据和计数 -->
                                        <Property Name="TriggeredTags" Value="Motor_Runtime"/>
                                    </Properties>
                                </Tag>
                                
                                <!-- 模式切换触发 -->
                                <Tag Name="Auto_Mode" Address="DB100.DBX4.0" DataType="BOOLEAN" AccessRights="ReadWrite">
                                    <Properties>
                                        <Property Name="Description" Value="切换自动模式（触发读取参数）"/>
                                        <Property Name="ScanRate" Value="200"/>
                                        <!-- 触发读取10个参数数组 -->
                                        <Property Name="TriggeredTags" Value="Auto_Params"/>
                                    </Properties>
                                </Tag>
                                
                                <!-- 报警触发 -->
                                <Tag Name="Alarm_OverHeat" Address="DB100.DBX5.0" DataType="BOOLEAN" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value="过热报警触发-读取温度数组"/>
                                        <Property Name="ScanRate" Value="200"/>
                                        <!-- 触发读取5个温度传感器数组 -->
                                        <Property Name="TriggeredTags" Value="Temperature_Zones"/>
                                    </Properties>
                                </Tag>
                                
                                <!-- 质量检测触发 -->
                                <Tag Name="Vision_Trig_OK" Address="DB200.DBX0.0" DataType="BOOLEAN" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value="视觉检测OK信号-触发质量数据"/>
                                        <Property Name="ScanRate" Value="200"/>
                                        <!-- 触发读取零件数据和尺寸 -->
                                        <Property Name="TriggeredTags" Value="Part_ID,Dimension_A,Dimension_B"/>
                                    </Properties>
                                </Tag>
                                
                                <!-- 批次完成触发 -->
                                <Tag Name="Batch_Complete" Address="DB100.DBX6.0" DataType="BOOLEAN" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value="批次完成信号-触发读取批次报告"/>
                                        <Property Name="ScanRate" Value="500"/>
                                        <!-- 触发读取20个批次统计数据数组 -->
                                        <Property Name="TriggeredTags" Value="Batch_Report"/>
                                    </Properties>
                                </Tag>
                            </Tags>
                        </TagGroup>

                        <!-- ==================== Word组：按需读取（被动模式） ==================== -->
                        <TagGroup Name="Word">
                            <Properties>
                                <Property Name="DefaultUpdateRate" Value="0"/>
                                <Property Name="Description" Value="按需读取-Bit触发后批量读取"/>
                                <!-- ScanRate="0" 表示不主动扫描，等待客户端读取 -->
                            </Properties>
                            
                            <Tags>
                                <!-- ========== 电机参数（受Motor_Start_CMD触发） ========== -->
                                <Tag Name="Motor_Current" Address="DB102.DBD0" DataType="FLOAT" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value="电机电流"/>
                                        <Property Name="ScanRate" Value="0"/>
                                        <Property Name="Units" Value="A"/>
                                    </Properties>
                                </Tag>
                                
                                <Tag Name="Motor_Frequency" Address="DB102.DBD4" DataType="FLOAT" AccessRights="ReadWrite">
                                    <Properties>
                                        <Property Name="Description" Value="电机频率设定"/>
                                        <Property Name="ScanRate" Value="0"/>
                                        <Property Name="Units" Value="Hz"/>
                                    </Properties>
                                </Tag>

                                <!-- ========== 运行数据（受Motor_Run_Status触发） ========== -->
                                <Tag Name="Motor_Runtime" Address="DB103.DBD0" DataType="DWORD" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value="电机累计运行时间"/>
                                        <Property Name="ScanRate" Value="0"/>
                                        <Property Name="Units" Value="小时"/>
                                        <Property name="ArchiveEnabled" Value="True"/>
                                        <Property name="ReportEnabled" Value="True"/>
                                    </Properties>
                                </Tag>
								
                                <!-- ========== 自动模式参数数组（10个参数） ========== -->
                                <!-- KepServer EX数组配置：Auto_Params[0]到Auto_Params[9] -->
                                <Tag Name="Auto_Params" Address="DB103.DBW0[10]" DataType="WORD" AccessRights="ReadWrite">
                                    <Properties>
                                        <Property Name="Description" Value="自动模式参数数组[0-9]"/>
                                        <Property Name="ScanRate" Value="0"/>
                                        <Property Name="ArrayLength" Value="10"/>
                                        <Property Name="Scaling" Value="None"/>
                                    </Properties>
                                </Tag>

                                <!-- ========== 温度区域数组（5个传感器） ========== -->
                                <Tag Name="Temperature_Zones" Address="DB101.DBW10[10]" DataType="WORD" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value="5个温度区数组[0-4]"/>
                                        <Property Name="ScanRate" Value="0"/>
                                        <Property Name="ArrayLength" Value="5"/>
                                        <Property Name="Units" Value="°C"/>
                                        <Property Name="Scaling" Value="Linear"/>
                                        <Property Name="RawLow" Value="0"/>
                                        <Property Name="RawHigh" Value="27648"/>
                                        <Property Name="ScaledLow" Value="0"/>
                                        <Property Name="ScaledHigh" Value="600"/>
                                    </Properties>
                                </Tag>

                                <!-- ========== 质量检测数据（受Vision_Trig_OK触发） ========== -->
                                <Tag Name="Part_ID" Address="DB200.DBW0" DataType="STRING" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value="零件ID条码"/>
                                        <Property Name="ScanRate" Value="0"/>
                                        <Property Name="StringLength" Value="50"/>
                                    </Properties>
                                </Tag>
                                
                                <Tag Name="Dimension_A" Address="DB200.DBD100" DataType="FLOAT" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value="尺寸A测量值"/>
                                        <Property Name="ScanRate" Value="0"/>
                                        <Property Name="Units" Value="mm"/>
                                        <Property name="ArchiveEnabled" Value="True"/>
                                    </Properties>
                                </Tag>
                                
                                <Tag Name="Dimension_B" Address="DB200.DBD104" DataType="FLOAT" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value="尺寸B测量值"/>
                                        <Property Name="ScanRate" Value="0"/>
                                        <Property Name="Units" Value="mm"/>
                                    </Properties>
                                </Tag>
                                
                                <!-- ========== 报警与故障数据（受Emergency_Stop触发） ========== -->
                                <Tag Name="Alarm_Status" Address="DB104.DBW0" DataType="WORD" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value = "报警状态字" />
                                        <Property Name="ScanRate" Value="0"/>
                                    </Properties>
                                </Tag>

                                <!-- ========== 批次报告数组（20个统计数据） ========== -->
                                <Tag Name="Batch_Report" Address="DB105.DBW0[40]" DataType="WORD" AccessRights="ReadOnly">
                                    <Properties>
                                        <Property Name="Description" Value="批次报告数组[0-19]"/>
                                        <Property Name="ScanRate" Value="0"/>
                                        <Property Name="ArrayLength" Value="20"/>
                                    </Properties>
                                </Tag>
                            </Tags>
                        </TagGroup>
					</TagGroups>
			    </Device>
           </Devices>
        </Channel>
    </Channels>

    <!-- C#客户端实现策略 -->
    <CustomProperties>
        <Property Name="Client.ReadStrategy" Value="EventDriven"/>
        <Property Name="Client.BitGroup" Value="Bit"/>
        <Property Name="Client.WordGroup" Value="Word"/>
        <Property Name="Client.BitPollInterval" Value="100"/>
        <Property Name="Client.WordReadBatchSize" Value="20"/>
    </CustomProperties>
</Project>