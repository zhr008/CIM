<?xml version="1.0" encoding="utf-8"?>
<KepServerConfiguration Version="1.0" LastUpdated="2025-10-30">
  <KepServerSettings>
    <!-- 连接超时时间: 30秒（从5秒增加到30秒） -->
    <ConnectionTimeout>30000</ConnectionTimeout>
    <!-- 重连间隔: 10秒 -->
    <ReconnectInterval>10000</ReconnectInterval>
    <!-- 最大重试次数: 3次 -->
    <MaxRetries>3</MaxRetries>
    <!-- 默认更新率: 100ms -->
    <UpdateRate>100</UpdateRate>
    <!-- 启用日志记录 -->
    <EnableLogging>true</EnableLogging>
    <!-- 日志级别: Info -->
    <LogLevel>Info</LogLevel>
  </KepServerSettings>

  <Servers>
    <!-- 主KepServer -->
    <Server ServerId="KepServer_01" ServerName="主KepServer" Host="192.168.1.100" Port="49320" ProtocolType="opc" Description="生产线主服务器" Enabled="true">
      <Projects>
        <!-- 生产线项目1 - 光刻生产线 -->
        <Project ProjectId="ProductionLine_01" ProjectName="生产线项目1" Description="光刻生产线" Enabled="true">
          <DataGroups>
            <!-- 设备状态组 -->
            <DataGroup GroupId="Group_01" GroupName="设备状态组" Enabled="true" UpdateRate="500">
              <BitAddresses>
                <BitAddress AddressId="BIT_001" Address="PLC001.STATUS.BIT001" Description="设备1运行状态触发" DataType="Boolean" InitialValue="false" Monitored="true" />
                <BitAddress AddressId="BIT_002" Address="PLC001.STATUS.BIT002" Description="设备2运行状态触发" DataType="Boolean" InitialValue="false" Monitored="true" />
                <BitAddress AddressId="BIT_003" Address="PLC001.STATUS.BIT003" Description="报警触发" DataType="Boolean" InitialValue="false" Monitored="true" />
              </BitAddresses>
              <WordAddresses>
                <WordAddress AddressId="WORD_001" Address="PLC001.DATA.WORD001" Description="设备1数据值" DataType="String" InitialValue="" MaxLength="100" />
                <WordAddress AddressId="WORD_002" Address="PLC001.DATA.WORD002" Description="设备2数据值" DataType="String" InitialValue="" MaxLength="100" />
                <WordAddress AddressId="WORD_003" Address="PLC001.DATA.WORD003" Description="报警信息" DataType="String" InitialValue="" MaxLength="200" />
              </WordAddresses>
              <BitWordMappings>
                <BitWordMapping MappingId="MAP_001" BitAddressId="BIT_001" WordAddressId="WORD_001" TriggerCondition="RisingEdge" Action="ReadWord" Description="设备1状态触发时读取数据" Enabled="true" />
                <BitWordMapping MappingId="MAP_002" BitAddressId="BIT_002" WordAddressId="WORD_002" TriggerCondition="RisingEdge" Action="ReadWord" Description="设备2状态触发时读取数据" Enabled="true" />
                <BitWordMapping MappingId="MAP_003" BitAddressId="BIT_003" WordAddressId="WORD_003" TriggerCondition="BothEdges" Action="ReadWord" Description="报警状态变化时读取信息" Enabled="true" />
              </BitWordMappings>
            </DataGroup>

            <!-- 生产数据组 -->
            <DataGroup GroupId="Group_02" GroupName="生产数据组" Enabled="true" UpdateRate="1000">
              <BitAddresses>
                <BitAddress AddressId="BIT_004" Address="PLC002.STATUS.BIT001" Description="批次开始触发" DataType="Boolean" InitialValue="false" Monitored="true" />
                <BitAddress AddressId="BIT_005" Address="PLC002.STATUS.BIT002" Description="批次完成触发" DataType="Boolean" InitialValue="false" Monitored="true" />
              </BitAddresses>
              <WordAddresses>
                <WordAddress AddressId="WORD_004" Address="PLC002.DATA.WORD001" Description="当前批次号" DataType="String" InitialValue="" MaxLength="50" />
                <WordAddress AddressId="WORD_005" Address="PLC002.DATA.WORD002" Description="产品信息" DataType="String" InitialValue="" MaxLength="100" />
              </WordAddresses>
              <BitWordMappings>
                <BitWordMapping MappingId="MAP_004" BitAddressId="BIT_004" WordAddressId="WORD_004" TriggerCondition="RisingEdge" Action="ReadWord" Description="批次开始时记录批次号" Enabled="true" />
                <BitWordMapping MappingId="MAP_005" BitAddressId="BIT_005" WordAddressId="WORD_005" TriggerCondition="RisingEdge" Action="ReadWord" Description="批次完成时记录产品信息" Enabled="true" />
              </BitWordMappings>
            </DataGroup>
          </DataGroups>
        </Project>

        <!-- 生产线项目2 - 蚀刻生产线 -->
        <Project ProjectId="ProductionLine_02" ProjectName="生产线项目2" Description="蚀刻生产线" Enabled="true">
          <DataGroups>
            <DataGroup GroupId="Group_03" GroupName="设备组" Enabled="true" UpdateRate="500">
              <BitAddresses>
                <BitAddress AddressId="BIT_006" Address="ETCH001.STATUS.READY" Description="设备就绪" DataType="Boolean" InitialValue="false" Monitored="true" />
              </BitAddresses>
              <WordAddresses>
                <WordAddress AddressId="WORD_006" Address="ETCH001.DATA.TEMPERATURE" Description="当前温度" DataType="String" InitialValue="" MaxLength="50" />
              </WordAddresses>
              <BitWordMappings>
                <BitWordMapping MappingId="MAP_006" BitAddressId="BIT_006" WordAddressId="WORD_006" TriggerCondition="RisingEdge" Action="ReadWord" Description="设备就绪时读取温度" Enabled="true" />
              </BitWordMappings>
            </DataGroup>
          </DataGroups>
        </Project>
      </Projects>
    </Server>

    <!-- 备用KepServer -->
    <Server ServerId="KepServer_02" ServerName="备用KepServer" Host="192.168.1.101" Port="49320" ProtocolType="opc" Description="生产线备用服务器" Enabled="false">
      <Projects>
        <Project ProjectId="Backup_01" ProjectName="备用项目" Description="备用配置" Enabled="false">
          <DataGroups />
        </Project>
      </Projects>
    </Server>
  </Servers>

  <DataInteraction Enabled="true" Mode="Async" BatchSize="10" BufferSize="1000">
    <PublishEvents>
      <PublishEvent EventId="EVENT_001" EventName="设备状态变化" Source="BitAddress" Trigger="RisingEdge" Action="ReadWord" PublishTopic="EQUIPMENT.STATUS.CHANGE" Enabled="true" />
      <PublishEvent EventId="EVENT_002" EventName="生产数据更新" Source="WordAddress" Trigger="ValueChange" Action="Publish" PublishTopic="PRODUCTION.DATA.UPDATE" Enabled="true" />
    </PublishEvents>
    <HistoryLog Enabled="true" RetentionDays="30" FilePath="logs/kepserver_history.log" />
  </DataInteraction>

  <Alerts Enabled="true">
    <ConnectionLost Enabled="true" Threshold="3" Action="LogAndNotify" />
    <DataTimeout Enabled="true" Threshold="30000" Action="Log" />
    <MappingError Enabled="true" Action="Log" />
  </Alerts>

  <Security>
    <Encryption Enabled="false" Algorithm="AES256" />
    <Authentication Enabled="false" Method="None" />
    <AccessControl Enabled="false">
      <Users />
    </AccessControl>
  </Security>
</KepServerConfiguration>
